{% extends "base.html" %}

{% block content %}
    <style>
            body{
             background-image: url("{{url_for('static', filename='res/search2.png')}}");
                background-repeat: no-repeat;
                background-size: cover;
                font-family: 'Cairo', sans-serif;
        }

            table{
                background-color: aquamarine;
            }

        tbody{
            background-color: white;
        }
    </style>
    <script language="javascript">
        function addRow(tableID)
        {
            var table = document.getElementById(tableID);
            var rowCount = table.rows.length;
            var row = table.insertRow(rowCount);
            var colCount = table.rows[0].cells.length;
            for(var i=0; i<colCount; i++)
            {
                var newcell = row.insertCell(i);
                newcell.innerHTML = table.rows[1].cells[i].innerHTML;
                if(i==0){
                    newcell.children[0].setAttribute("name","skills"+rowCount)
                    }
                else if(i==1){
                    newcell.children[0].setAttribute("name","experience"+rowCount)
                    }
                else{
                    newcell.children[0].setAttribute("name","rating"+rowCount)
                    }
                console.log(newcell.children[0])
            }
        }
        function deleteRow(tableID) {
            try {
            var table = document.getElementById(tableID);
            var rowCount = table.rows.length;
            var colcnt = 3
            for(var i=0; i<rowCount; i++) {
                var row = table.rows[i];
                var chkbox = row.cells[3].childNodes[0];
                if(null != chkbox && true === chkbox.checked)
                {
                    if(rowCount <= 2)
                    {
                        alert("Cannot delete all the rows.");
                        break;
                    }
                    table.deleteRow(i);
                    rowCount--;
                    i--;
                }
            }
            var table = document.getElementById(tableID);
            for (var i = 0, row; row = table.rows[i]; i++) {
                  row.id="row"+i;
               for (var j = 0, col; col = row.cells[j]; j++) {
                 col.id="col"+i;
                 if(j==0)
                 {
                 }
                 else if(j==1)
                 {
                }
               }
            }
            }catch(e) {
                alert(e);
            }
        }
    </script>
    <link href="https://code.jquery.com/jquery-3.3.1.js">
    <link href="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js">
    <link href="https://cdn.datatables.net/fixedheader/3.1.6/js/dataTables.fixedHeader.min.js">
    <form action="" method="post" id="form" class="container-fluid">
        <div style="height:180px;overflow:auto;">
            <table id="dataTable" class="table table-striped table-bordered">
            <thead class="thead-light">
                <tr>
                  <th scope="col"><h5>Skills</h5></th>
                  <th scope="col"><h5>Experience</h5></th>
                  <th scope="col"><h5>Rating</h5></th>
                  <th scope="col"></th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <select class="form-control" id="skills" name="skills1" style="width: 120px">
                            <option value="any" selected>Any</option>
                            <option value="Java">Java</option>
                            <option value="Python">Python</option>
                            <option value="Scala">Scala</option>
                            <option value="Angular">Angular</option>
                            <option value="JS">JS</option>
                        </select>
                    </td>
                    <td>
                        <input type="text" id="experience" class="form-control" name="experience1" value="0" style="width: 220px" required>
                    </td>
                    <td>
                        <select class="form-control" id="rating" name="rating1" style="width: 80px">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select>
                    </td>
                    <td id="col_0_0"><input type="checkbox" name="chk"></td>
                </tr>
            </tbody>
        </table>
        </div>
        <input style="margin-top: 10px;" type="button" class="btn btn-light" value="Add Skill" onclick="addRow('dataTable')">
        <input style="margin-top: 10px;" type="button" class="btn btn-light" value="Delete Skill" onclick="deleteRow('dataTable')">
        <br>
    </form>
    <button style="margin-left:auto;margin-right:auto;display:block;padding-top: 5px;" type="submit" class="btn btn-primary" form="form" value="Submit" id="button">Search</button>
    <br>
        <script>
            $(document).ready(function() {
            $('#example thead tr').clone(true).appendTo( '#example thead' );
            $('#example thead tr:eq(1) th').each( function (i) {
                var title = $(this).text();
                $(this).html( '<input type="text" placeholder="Search '+title+'" />' );

                $( 'input', this ).on( 'keyup change', function () {
                    if ( table.column(i).search() !== this.value ) {
                        table
                            .column(i)
                            .search( this.value )
                            .draw();
                    }
                } );
            } );

            var table = $('#example').DataTable( {
                orderCellsTop: true,
                fixedHeader: true
            } );
        } );

        </script>
        <div class="container-fluid">
         <table id="results" class="table table-bordered">
            <thead class="thead-light">
                <tr>
                    <th scope="col">Employee ID</th>
                    <th scope="col">Employee Name</th>
                    <th scope="col">Employee e-mail</th>
                    <th scope="col">Practice</th>
                    <th scope="col">Location</th>
                    <th scope="col">Statistics</th>
                </tr>
            </thead>
            <tbody>
            {% for i in result %}
                <tr>
                    <td>{{ i[0].id }}</td>
                    <td>{{ i[0].username }}</td>
                    <td>{{ i[0].email }}</td>
                    <td>{{ i[0].practice }}</td>
                    <td>{{ i[0].location }}</td>
                    {% if i[1] == 0 %}
                    <td><a href="{{ url_for('emp_stats', id=i[0].id ) }}">Check Stats</a></td>
                    {% else %}
                    <td>{{ i[1] }}</td>
                    {% endif %}
                </tr>
            {% endfor %}
            </tbody>
        </table>
        </div>

{% endblock %}
